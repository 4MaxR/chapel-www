

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using Chapel with GASNet &mdash; Chapel Documentation 2.7</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=70f659a1" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=dfec817d"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Using Chapel with libfabric" href="libfabric.html" />
    <link rel="prev" title="Using Chapel with Omni-Path" href="../networks/omnipath.html" />
   
  

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

<a href="../../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>2.7
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "2.7";
$pagename = "platforms/comm-layers/gasnet";
include "../..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Platform-Specific Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#major-platforms">Major Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#networks">Networks</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#communication-layers">Communication Layers</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Using Chapel with GASNet</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-is-gasnet">What is GASNet?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-chpl-comm-substrate">Setting CHPL_COMM_SUBSTRATE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-chpl-gasnet-segment">Setting CHPL_GASNET_SEGMENT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multilocale-execution-with-shared-memory">Multilocale Execution with Shared-Memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#emulating-distributed-execution-with-the-udp-conduit">Emulating Distributed Execution with the UDP Conduit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-the-gasnet-mpi-conduit">Using the GASNet MPI Conduit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="libfabric.html">Using Chapel with libfabric</a></li>
<li class="toctree-l3"><a class="reference internal" href="ugni.html">Using Chapel with ugni</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#older-platforms">Older Platforms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Docs for Contributors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Writing Chapel Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../primers/index.html">Primers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mason-packages/index.html">Mason Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

  <p class="caption" role="heading"><span class="caption-text">Indexes</span></p>
  <ul>
    <li class="toctree-11"><a class="reference internal" href="../../chpl-modindex.html">Chapel Module Index</a></li>
    <li class="toctree-11"><a class="reference internal" href="../../genindex.html">Complete Docs Index</a></li>
  </ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Chapel Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Platform-Specific Notes</a></li>
      <li class="breadcrumb-item active">Using Chapel with GASNet</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/platforms/comm-layers/gasnet.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="using-chapel-with-gasnet">
<span id="readme-gasnet"></span><h1>Using Chapel with GASNet<a class="headerlink" href="#using-chapel-with-gasnet" title="Link to this heading"></a></h1>
<section id="what-is-gasnet">
<span id="id1"></span><h2>What is GASNet?<a class="headerlink" href="#what-is-gasnet" title="Link to this heading"></a></h2>
<p>GASNet is a one-sided communication and active message library being
developed by Lawrence Berkeley National Laboratory and UC Berkeley.  For
details, refer to the <a class="reference external" href="https://gasnet.lbl.gov/">GASNet website</a>.</p>
</section>
<section id="setting-chpl-comm-substrate">
<span id="set-comm-conduit"></span><h2>Setting CHPL_COMM_SUBSTRATE<a class="headerlink" href="#setting-chpl-comm-substrate" title="Link to this heading"></a></h2>
<p>Users can set <code class="docutils literal notranslate"><span class="pre">CHPL_COMM_SUBSTRATE</span></code> to indicate the GASNet conduit that
they wish to use. Conduits are alternative implementations of the GASNet
library. GASNet uses different conduits to support different networks.
Novice users can leave this unset and Chapel will make a choice for them.</p>
<p>Most settings for <code class="docutils literal notranslate"><span class="pre">CHPL_COMM_SUBSTRATE</span></code> rely on the particular network
hardware. The options include:</p>
<dl class="simple">
<dt>ibv</dt><dd><p>OpenIB/OpenFabrics Verbs for InfiniBand
(see <a class="reference internal" href="../networks/infiniband.html#readme-infiniband"><span class="std std-ref">Using Chapel with InfiniBand</span></a>)</p>
</dd>
<dt>udp</dt><dd><p>UDP - portable conduit, works on any network with a TCP/IP stack
(see <a class="reference internal" href="../networks/ethernet.html#using-udp"><span class="std std-ref">Using the Portable UDP Conduit</span></a>)</p>
</dd>
<dt>mpi</dt><dd><p>MPI - portable conduit, works on any network with MPI 1.1 or newer
(see <a class="reference internal" href="#readme-gasnet-mpi"><span class="std std-ref">Using the GASNet MPI Conduit</span></a>)</p>
</dd>
<dt>smp</dt><dd><p>Runs multiple co-locales on a single shared-memory machine
(see <a class="reference internal" href="#readme-gasnet-smp"><span class="std std-ref">Multilocale Execution with Shared-Memory</span></a>)</p>
</dd>
<dt>ofi</dt><dd><p>OpenFabrics Interface (libfabric) for Slingshot and Omni-Path.</p>
</dd>
<dt>ucx</dt><dd><p>Unified Communication X for InfiniBand. Chapel does not actively support this
substrate and its use is not recommended.</p>
</dd>
</dl>
<p>See the <a class="reference external" href="https://gasnet.lbl.gov/">GASNet website</a> for more
information on each of these conduits.</p>
<p>Current defaults are:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>CHPL_TARGET_PLATFORM</p></th>
<th class="head"><p>CHPL_COMM_SUBSTRATE</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cray-cs</p></td>
<td><p>ibv</p></td>
</tr>
<tr class="row-odd"><td><p>pwr6</p></td>
<td><p>ibv</p></td>
</tr>
<tr class="row-even"><td><p>other</p></td>
<td><p>udp</p></td>
</tr>
</tbody>
</table>
</section>
<section id="setting-chpl-gasnet-segment">
<span id="set-comm-segment"></span><h2>Setting CHPL_GASNET_SEGMENT<a class="headerlink" href="#setting-chpl-gasnet-segment" title="Link to this heading"></a></h2>
<p>Users can set <code class="docutils literal notranslate"><span class="pre">CHPL_GASNET_SEGMENT</span></code> to choose a memory segment to use
with GASNet. A GASNet segment is a region of memory that is expected to
be used for remote memory access. The GASNet library works to make memory
in this segment available for accelerated memory access supported
directly by network hardware.  The options are:</p>
<dl class="simple">
<dt>everything</dt><dd><p>All memory is available for remote memory access.
This option is not supported with the <code class="docutils literal notranslate"><span class="pre">smp</span></code> or <code class="docutils literal notranslate"><span class="pre">ucx</span></code> substrates.
If using the <code class="docutils literal notranslate"><span class="pre">ofi</span></code> substrate, this option is not supported when targeting
the <code class="docutils literal notranslate"><span class="pre">cxi</span></code> provider (Slingshot).</p>
</dd>
<dt>fast</dt><dd><p>A limited portion of memory is available and optimized for fastest remote
memory access</p>
</dd>
<dt>large</dt><dd><p>As with fast, but a larger amount of memory is available for communication</p>
</dd>
</dl>
<p>Each choice of segment has different tradeoffs. For the <code class="docutils literal notranslate"><span class="pre">fast</span></code> segment,
the Chapel heap is entirely in memory that can be directly accessed over
the network, but the drawback is that the size of the heap must be
specified at program start-up. For <code class="docutils literal notranslate"><span class="pre">everything</span></code>, accessing memory over
the network is generally slower, but there is no need to worry about the
size of the heap or whether some memory is registered with the network.
The <code class="docutils literal notranslate"><span class="pre">large</span></code> segment offers a compromise between these two options,
where some portion of the heap will be available for faster network
access.</p>
<p>Current defaults are:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>CHPL_COMM_SUBSTRATE</p></th>
<th class="head"><p>CHPL_GASNET_SEGMENT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ibv</p></td>
<td><p>large</p></td>
</tr>
<tr class="row-odd"><td><p>ofi</p></td>
<td><p>fast (only when the <code class="docutils literal notranslate"><span class="pre">CHPL_TARGET_PLATFORM</span></code> is a
<code class="docutils literal notranslate"><span class="pre">hpe-cray-ex</span></code> or <code class="docutils literal notranslate"><span class="pre">hpe-cray-xd</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p>smp</p></td>
<td><p>fast</p></td>
</tr>
<tr class="row-odd"><td><p>ucx</p></td>
<td><p>fast</p></td>
</tr>
<tr class="row-even"><td><p>other</p></td>
<td><p>everything</p></td>
</tr>
</tbody>
</table>
</section>
<section id="multilocale-execution-with-shared-memory">
<span id="readme-gasnet-smp"></span><h2>Multilocale Execution with Shared-Memory<a class="headerlink" href="#multilocale-execution-with-shared-memory" title="Link to this heading"></a></h2>
<p>When running Chapel programs with <code class="docutils literal notranslate"><span class="pre">CHPL_COMM=gasnet</span></code>, you can use the
<code class="docutils literal notranslate"><span class="pre">smp</span></code> conduit to have multilocale execution on a single shared-memory
machine. This emulates a multinode environment by partitioning the machine’s
resources (similar to <a class="reference internal" href="../../usingchapel/multilocale.html#readme-colocale"><span class="std std-ref">Co-locales</span></a>). This allows you to run Chapel
programs that are designed for multinode execution without needing a
distributed system or network support. To do this,
set the environment variable <code class="docutils literal notranslate"><span class="pre">CHPL_COMM_SUBSTRATE</span></code> to <code class="docutils literal notranslate"><span class="pre">smp</span></code> before
running your Chapel program:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">CHPL_COMM</span><span class="o">=</span>gasnet
<span class="nb">export</span><span class="w"> </span><span class="nv">CHPL_COMM_SUBSTRATE</span><span class="o">=</span>smp
</pre></div>
</div>
<p>Using Chapel in this way will partition the machine’s resources into
multiple locales.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">smp</span></code> conduit is designed for shared-memory execution and is very similar
to <a class="reference internal" href="../../usingchapel/multilocale.html#readme-colocale"><span class="std std-ref">Co-locales</span></a>. Notably, when specifying the number of locales
the following commands are equivalent:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./myprogram<span class="w"> </span>-nl<span class="w"> </span><span class="m">4</span>
./myprogram<span class="w"> </span>-nl<span class="w"> </span>1x4
./myprogram<span class="w"> </span>-nl<span class="w"> </span>4x1
</pre></div>
</div>
<p>All of these will result in 4 locales running on a single node/machine,
partitioning the resources of that node between them.</p>
</section>
<section id="emulating-distributed-execution-with-the-udp-conduit">
<span id="readme-gasnet-emulating-multilocale"></span><h2>Emulating Distributed Execution with the UDP Conduit<a class="headerlink" href="#emulating-distributed-execution-with-the-udp-conduit" title="Link to this heading"></a></h2>
<p>While the <a class="reference internal" href="../networks/ethernet.html#using-udp"><span class="std std-ref">UDP conduit</span></a> is primarily intended for portable
multilocale execution over ethernet, it can also be used to run multiple
locales locally on a single node by <a class="reference internal" href="../../usingchapel/executing.html#oversubscribed-execution"><span class="std std-ref">oversubscribing</span></a> the machine’s resources.</p>
<p>With a build of Chapel with <code class="docutils literal notranslate"><span class="pre">CHPL_COMM=gasnet</span></code> and
<code class="docutils literal notranslate"><span class="pre">CHPL_COMM_SUBSTRATE=udp</span></code>, you can run a Chapel program on multiple locales
on a single machine with the following environment variable settings:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">GASNET_SPAWNFN</span><span class="o">=</span>L
<span class="nb">export</span><span class="w"> </span><span class="nv">GASNET_ROUTE_OUTPUT</span><span class="o">=</span><span class="m">0</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GASNET_MASTERIP</span><span class="o">=</span><span class="m">127</span>.0.0.1
<span class="nb">export</span><span class="w"> </span><span class="nv">GASNET_WORKERIP</span><span class="o">=</span><span class="m">127</span>.0.0.0
<span class="nb">export</span><span class="w"> </span><span class="nv">CHPL_RT_OVERSUBSCRIBED</span><span class="o">=</span>yes
</pre></div>
</div>
<p>See the documentation for the <a class="reference internal" href="../networks/ethernet.html#using-udp"><span class="std std-ref">UDP conduit</span></a> for more details on
what these environment variables do.</p>
<section id="when-should-i-use-chpl-comm-substrate-udp-vs-chpl-comm-substrate-smp">
<span id="readme-udp-vs-smp"></span><h3>When should I use <code class="docutils literal notranslate"><span class="pre">CHPL_COMM_SUBSTRATE=udp</span></code> vs <code class="docutils literal notranslate"><span class="pre">CHPL_COMM_SUBSTRATE=smp</span></code>?<a class="headerlink" href="#when-should-i-use-chpl-comm-substrate-udp-vs-chpl-comm-substrate-smp" title="Link to this heading"></a></h3>
<p>While both the <code class="docutils literal notranslate"><span class="pre">udp</span></code> and <code class="docutils literal notranslate"><span class="pre">smp</span></code> conduits can be used to run multilocale
Chapel programs on a single node or shared memory machine (e.g. laptops or
workstations), there are a few key differences:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">udp</span></code> creates multiple locales on a single node that
<a class="reference internal" href="../../usingchapel/executing.html#oversubscribed-execution"><span class="std std-ref">oversubscribe</span></a> the machine’s resources,
so each locale is sharing the same resources. <code class="docutils literal notranslate"><span class="pre">smp</span></code> creates multiple
co-locales which partition the machine’s resources between them, so each
locale has its own dedicated resources.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">udp</span></code> (by default with <code class="docutils literal notranslate"><span class="pre">CHPL_GASNET_SEGMENT=everything</span></code>) implements
communication between locales over the TCP/IP network, so all traffic is
routed through the network stack. <code class="docutils literal notranslate"><span class="pre">smp</span></code> always uses shared memory for
communication between co-locales, which can be more efficient and requires
less configuration.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">udp</span></code> always requires a working network configuration to start jobs and can
sometimes require additional configuration tweaks to successfully spawn jobs
in the presence of firewalls or misconfigured DNS services. <code class="docutils literal notranslate"><span class="pre">smp</span></code> does not
rely on any network services.</p></li>
</ul>
</section>
</section>
<section id="using-the-gasnet-mpi-conduit">
<span id="readme-gasnet-mpi"></span><h2>Using the GASNet MPI Conduit<a class="headerlink" href="#using-the-gasnet-mpi-conduit" title="Link to this heading"></a></h2>
<p>To use MPI directly with GASNet, you must set the
<code class="docutils literal notranslate"><span class="pre">CHPL_COMM_SUBSTRATE</span></code> environment variable to <code class="docutils literal notranslate"><span class="pre">mpi</span></code> and rebuild Chapel. This will
configure Chapel to use the MPI conduit of GASNet, which allows you to
run Chapel programs using the MPI library for communication between locales.</p>
<p>For best practices about how to configure/use GASNet to avoid such conflicts
with MPI, please see the
<a class="reference external" href="https://bitbucket.org/berkeleylab/gasnet/src/master/mpi-conduit/README">GASNet docs for the MPI Conduit</a>
(also available at
<code class="docutils literal notranslate"><span class="pre">$CHPL_HOME/third-party/gasnet/gasnet-src/mpi-conduit/README</span></code>).</p>
<section id="troubleshooting">
<span id="readme-gasnet-troubleshooting"></span><h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h3>
<p>For <code class="docutils literal notranslate"><span class="pre">CHPL_COMM=gasnet</span></code> runs, you may also want to consider setting
one or both of:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">GASNET_SPAWN_VERBOSE</span><span class="o">=</span><span class="m">1</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GASNET_VERBOSEENV</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</div></blockquote>
<p>where the first prints more information about GASNet’s job launch
actions, and the second is used to audit environment variable
settings.</p>
<p>When running <code class="docutils literal notranslate"><span class="pre">CHPL_COMM=gasnet</span></code> programs using the <code class="docutils literal notranslate"><span class="pre">udp</span></code> conduit,
we’ve had best results with console I/O using:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">GASNET_ROUTE_OUTPUT</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../networks/omnipath.html" class="btn btn-neutral float-left" title="Using Chapel with Omni-Path" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="libfabric.html" class="btn btn-neutral float-right" title="Using Chapel with libfabric" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Chapel a Series of LF Projects, LLC.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>